<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>main.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>main.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment">                          main.cpp  -  The file containing main ;-)</font>
00003 <font class="comment">                             -------------------</font>
00004 <font class="comment">    begin                : Mit Jan 19 12:57:15 CET 2000</font>
00005 <font class="comment">    copyright            : (C) 2000 by The BibleTime Team</font>
00006 <font class="comment">    email                : Info@bibletime.de</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment">*                                                                         *</font>
00011 <font class="comment">*   This program is free software; you can redistribute it and/or modify  *</font>
00012 <font class="comment">*   it under the terms of the GNU General Public License as published by  *</font>
00013 <font class="comment">*   the Free Software Foundation; either version 2 of the License, or     *</font>
00014 <font class="comment">*   (at your option) any later version.                                   *</font>
00015 <font class="comment">*                                                                         *</font>
00016 <font class="comment">***************************************************************************/</font>
00017 
00018     
00019 <font class="comment">/* $Header$ */</font>
00020 <font class="comment">/* $Revision$ */</font>
00021 
00022 <font class="comment">//standard includes</font>
00023 <font class="preprocessor">#include &lt;stdlib.h&gt;</font>
00024 <font class="preprocessor">#include &lt;stdio.h&gt;</font>
00025 <font class="preprocessor">#include &lt;signal.h&gt;</font>
00026 
00027 <font class="comment">//own includes</font>
00028 <font class="preprocessor">#include "resource.h"</font>
00029 <font class="preprocessor">#include "bibletime.h"</font>
00030 <font class="preprocessor">#include "config.h"</font>
00031 
00032 <font class="comment">//frontend includes</font>
00033 <font class="preprocessor">#include "frontend/kstartuplogo.h"</font>
00034 <font class="preprocessor">#include "frontend/chtmldialog.h"</font>
00035 <font class="preprocessor">#include "frontend/cbtconfig.h"</font>
00036 
00037 <font class="comment">//KDE includes</font>
00038 <font class="preprocessor">#include &lt;kcmdlineargs.h&gt;</font>
00039 <font class="preprocessor">#include &lt;kcrash.h&gt;</font>
00040 <font class="preprocessor">#include &lt;kglobal.h&gt;</font>
00041 <font class="preprocessor">#include &lt;kapplication.h&gt;</font>
00042 <font class="preprocessor">#include &lt;kstandarddirs.h&gt;</font>
00043 <font class="preprocessor">#include &lt;kinstance.h&gt;</font>
00044 <font class="preprocessor">#include &lt;kaboutdata.h&gt;</font>
00045 <font class="preprocessor">#include &lt;klocale.h&gt;</font>
00046 
00047 <font class="preprocessor">#include &lt;kmessagebox.h&gt;</font>
00048 
00049 <font class="keywordtype">bool</font> showDebugMessages = <font class="keyword">false</font>;
00050 <a class="code" href="class_bible_time.html">BibleTime</a>* bibletime = 0;
00051 
00052 <font class="keywordtype">void</font> myMessageOutput( QtMsgType type, <font class="keyword">const</font> <font class="keywordtype">char</font> *msg ) {   
00053     <font class="comment">//we use this messagehandler to switch debugging off in final releases</font>
00054     <font class="keywordflow">switch</font> ( type ) {
00055         <font class="keywordflow">case</font> QtDebugMsg:
00056             <font class="keywordflow">if</font> (showDebugMessages)  <font class="comment">//only show messages if they are enabled!</font>
00057                 fprintf( stderr,<font class="stringliteral">"(BibleTime %s) Debug: %s\n"</font>,VERSION, msg );
00058             <font class="keywordflow">break</font>;
00059         <font class="keywordflow">case</font> QtWarningMsg:
00060                 fprintf( stderr,<font class="stringliteral">"(BibleTime %s) WARNING: %s\n"</font>,VERSION, msg );
00061             <font class="keywordflow">break</font>;
00062         <font class="keywordflow">case</font> QtFatalMsg:
00063             fprintf( stderr,<font class="stringliteral">"(BibleTime %s) _FATAL_: %s\nPlease contact info@bibletime.de and report this bug!"</font>,VERSION, msg );
00064             abort();    <font class="comment">// dump core on purpose</font>
00065     }
00066 }
00067 
00068 <font class="keyword">extern</font> <font class="stringliteral">"C"</font> {
00069     <font class="keyword">static</font> <font class="keywordtype">void</font> setSignalHandler(<font class="keywordtype">void</font> (*handler)(<font class="keywordtype">int</font>));
00070 
00071     <font class="comment">// Crash recovery signal handler</font>
00072     <font class="keyword">static</font> <font class="keywordtype">void</font> signalHandler(<font class="keywordtype">int</font> sigId) {
00073         setSignalHandler(SIG_DFL);
00074         fprintf(stderr, <font class="stringliteral">"*** BibleTime got signal %d (Exiting)\n"</font>, sigId);
00075         <font class="comment">// try to cleanup all windows</font>
00076         <font class="keywordflow">if</font> (bibletime) {
00077             bibletime-&gt;<a class="code" href="class_bible_time.html#a4">saveSettings</a>();
00078             fprintf(stderr, <font class="stringliteral">"*** Saving seemed to be succesful. If restoring does not work on next startup \</font>
00079 <font class="stringliteral">please use the option --ignore-startprofile\n"</font>);
00080         }
00081         ::exit(-1); <font class="comment">//exit BibleTime</font>
00082     }
00083 
00084     <font class="comment">// Crash recovery signal handler</font>
00085     <font class="keyword">static</font> <font class="keywordtype">void</font> crashHandler(<font class="keywordtype">int</font> sigId) {
00086         setSignalHandler(SIG_DFL);
00087         fprintf(stderr, <font class="stringliteral">"*** BibleTime got signal %d (Crashing). Trying to save settings.\n"</font>, sigId);
00088         <font class="keywordflow">if</font> (bibletime) {
00089             bibletime-&gt;<a class="code" href="class_bible_time.html#a4">saveSettings</a>();
00090             fprintf(stderr, <font class="stringliteral">"*** Saving seemed to be succesful. If restoring does not work on next startup \</font>
00091 <font class="stringliteral">please use the option --ignore-startprofile\n"</font>);        
00092         }
00093         <font class="comment">// Return to DrKonqi.</font>
00094     }
00095 
00096     <font class="keyword">static</font> <font class="keywordtype">void</font> setSignalHandler(<font class="keywordtype">void</font> (*handler)(<font class="keywordtype">int</font>)) {
00097         signal(SIGKILL, handler);
00098         signal(SIGTERM, handler);
00099         signal(SIGHUP,  handler);
00100         KCrash::setEmergencySaveFunction(crashHandler);
00101     }
00102 }
00103 
00104 <font class="keywordtype">int</font> main(<font class="keywordtype">int</font> argc, <font class="keywordtype">char</font>* argv[]) {
00105     qInstallMsgHandler( myMessageOutput );
00106 
00107     <font class="comment">//create about data for this application</font>
00108     <font class="keyword">static</font> KCmdLineOptions options[] =
00109     {
00110         {<font class="stringliteral">"debug"</font>, I18N_NOOP(<font class="stringliteral">"Enable debug messages"</font>),0},
00111         {<font class="stringliteral">"ignore-startprofile"</font>, I18N_NOOP(<font class="stringliteral">"Ignore the startup profile saved after the last BibleTime execution."</font>),0},
00112         {<font class="stringliteral">"open-default-bible &lt;key&gt;"</font>, I18N_NOOP(<font class="stringliteral">"Opens the default bible with the given key. Use &lt;random&gt; to open ata random position."</font>),0},
00113         {0,0,0}
00114     };  
00115         
00116     KAboutData aboutData(
00117         PACKAGE,
00118         <font class="stringliteral">"BibleTime"</font>,
00119         VERSION,
00120         I18N_NOOP(<font class="stringliteral">"Bible study tool for KDE"</font>),
00121         KAboutData::License_GPL_V2,
00122         I18N_NOOP(<font class="stringliteral">"(c)1999-2002, The BibleTime Team"</font>),
00123         I18N_NOOP(<font class="stringliteral">"BibleTime is an easy to use but powerful Bible study tool for KDE.\n\nWe are looking for developers and translators.\nIf you'd like to join use send an eMail to info@bibletime.de."</font>),
00124         <font class="stringliteral">"http://www.bibletime.de/"</font>,
00125         <font class="stringliteral">"info@bibletime.de"</font>
00126     );
00127     
00128     <font class="comment">//we could so change this to a file reading function (including commented out people</font>
00129     <font class="comment">//coders</font>
00130     <font class="comment">// active developers (sorted by name)                                                                                       </font>
00131     aboutData.addAuthor(<font class="stringliteral">"Joachim Ansorg"</font>, I18N_NOOP(<font class="stringliteral">"Project coordinator"</font>), <font class="stringliteral">"jansorg@gmx.de"</font>,                   <font class="stringliteral">""</font>);
00132     aboutData.addAuthor(<font class="stringliteral">"Martin Gruner"</font>,    I18N_NOOP(<font class="stringliteral">"Frontend, backend"</font>),     <font class="stringliteral">"mg.pub@gmx.net"</font>,               <font class="stringliteral">""</font>);
00133     aboutData.addAuthor(<font class="stringliteral">"Mark Lybarger"</font>,    I18N_NOOP(<font class="stringliteral">"Searchdialog"</font>),              <font class="stringliteral">"mlybarge@insight.rr.com"</font>,<font class="stringliteral">""</font>);
00134 <font class="comment">//  aboutData.addAuthor("Chris Kujawa",     I18N_NOOP("Frontend"),"christopher.kujawa@verizon.net", "");</font>
00135 <font class="comment">//  aboutData.addAuthor("Luke Mauldin",     I18N_NOOP("Frontend"),"lukeskyfly@txk.net", "");</font>
00136 <font class="comment">//  aboutData.addAuthor("Tim Brodie",   I18N_NOOP("Installation manager"),"tbrodie@displayworksinc.com", "");</font>
00137 
00138     <font class="comment">//artwork (sorted by name)</font>
00139     aboutData.addAuthor(<font class="stringliteral">"Timothy R. Butler"</font>, I18N_NOOP(<font class="stringliteral">"Icons, startlogo, banners"</font>), <font class="stringliteral">"tbutler@uninetsolutions.com"</font>, <font class="stringliteral">"www.uninetsolutions.com"</font>);
00140         
00141     <font class="comment">//documentation (sorted by name)</font>
00142     aboutData.addAuthor(<font class="stringliteral">"Fred Saalbach"</font>, I18N_NOOP(<font class="stringliteral">"Handbook"</font>), <font class="stringliteral">"saalbach@sybercom.net"</font>, <font class="stringliteral">""</font>);       
00143     
00144     <font class="comment">//translators (sorted by language)</font>
00145     aboutData.addAuthor(<font class="stringliteral">"Michal Rovnaník"</font>,      I18N_NOOP(<font class="stringliteral">"Translation into Czech"</font>),            <font class="stringliteral">"Michal.Rovnanik@seznam.cz"</font>,    <font class="stringliteral">""</font>);    
00146     aboutData.addAuthor(<font class="stringliteral">"Birger Langkjer"</font>,      I18N_NOOP(<font class="stringliteral">"Translation into Danish"</font>),       <font class="stringliteral">"birger.langkjer@image.dk"</font>,     <font class="stringliteral">""</font>);
00147     aboutData.addAuthor(<font class="stringliteral">"Kees van Veen"</font>,            I18N_NOOP(<font class="stringliteral">"Translation into Dutch"</font>),            <font class="stringliteral">"cvn@interchain.nl"</font>,                    <font class="stringliteral">""</font>);
00148 <font class="comment">//  aboutData.addAuthor("Mario Bertrand",     I18N_NOOP("Translation into French"),         "mbert@tbrq.org",                       "");</font>
00149     aboutData.addAuthor(<font class="stringliteral">"Mathias Bavay"</font>,        I18N_NOOP(<font class="stringliteral">"Translation into French"</font>),       <font class="stringliteral">"mathias.bavay@free.fr"</font>,                        <font class="stringliteral">""</font>);
00150     aboutData.addAuthor(<font class="stringliteral">"Balint Sandor"</font>,            I18N_NOOP(<font class="stringliteral">"Translation into Hungarian"</font>),    <font class="stringliteral">"balintsa@freemail.hu"</font>,             <font class="stringliteral">""</font>);
00151     aboutData.addAuthor(<font class="stringliteral">"Beda Szukics"</font>,             I18N_NOOP(<font class="stringliteral">"Translation into Italian"</font>),      <font class="stringliteral">"bszukics@bluewin.ch"</font>,              <font class="stringliteral">""</font>);
00152     aboutData.addAuthor(<font class="stringliteral">"Silvio Bacchetta"</font>,     I18N_NOOP(<font class="stringliteral">"Translation into Italian"</font>),      <font class="stringliteral">"sorgilazzaro@tiscalinet.it"</font>, <font class="stringliteral">""</font>);
00153     aboutData.addAuthor(<font class="stringliteral">"Espen Trydal"</font>,             I18N_NOOP(<font class="stringliteral">"Translation into Norwegian"</font>),    <font class="stringliteral">"etrydal@postkassa.no"</font>,             <font class="stringliteral">""</font>);
00154     aboutData.addAuthor(<font class="stringliteral">"Benedykt P. Barszcz"</font>,I18N_NOOP(<font class="stringliteral">"Translation into Polish"</font>),         <font class="stringliteral">"kb2qzv@box43.gnet.pl"</font>,             <font class="stringliteral">""</font>);    
00155     aboutData.addAuthor(<font class="stringliteral">"Nuno Bareto"</font>,              I18N_NOOP(<font class="stringliteral">"Translation into Portoguese"</font>), <font class="stringliteral">"nbarr@oninet.pt"</font>,                        <font class="stringliteral">""</font>);    
00156     aboutData.addAuthor(<font class="stringliteral">"Yuriy Salimovskyy"</font>,    I18N_NOOP(<font class="stringliteral">"Translation into Russian"</font>),      <font class="stringliteral">"y2000@pisem.net"</font>,                      <font class="stringliteral">""</font>);    
00157     aboutData.addAuthor(<font class="stringliteral">"Zdeno Podobny"</font>,            I18N_NOOP(<font class="stringliteral">"Translation into Slovak"</font>),       <font class="stringliteral">"zdpo@post.sk"</font>,                             <font class="stringliteral">""</font>);    
00158     aboutData.addAuthor(<font class="stringliteral">"Eduardo Sanchez"</font>,      I18N_NOOP(<font class="stringliteral">"Translation into Spanish"</font>),      <font class="stringliteral">"csanche2@calvin.edu"</font>,              <font class="stringliteral">""</font>);
00159 
00160     <font class="comment">//credits (sorted by name)</font>
00161     aboutData.addCredit(<font class="stringliteral">"Bob Harman"</font>, I18N_NOOP(<font class="stringliteral">"Bible study HowTo"</font>), <font class="stringliteral">"N_Cov_Church@compuserve.com"</font>, <font class="stringliteral">""</font>);
00162         
00163     KCmdLineArgs::init(argc, argv, &amp;aboutData);     
00164     KCmdLineArgs::addCmdLineOptions ( options );
00165     
00166   KApplication::disableAutoDcopRegistration();
00167 
00168     KApplication app;
00169     KGlobal::dirs()-&gt;addResourceType(<font class="stringliteral">"BT_pic"</font>, <font class="stringliteral">"share/apps/bibletime/pics/"</font>);
00170 
00171     KCmdLineArgs *args = KCmdLineArgs::parsedArgs();
00172 
00173     <font class="comment">// A binary option (on / off)</font>
00174     <font class="keywordflow">if</font> (args-&gt;isSet(<font class="stringliteral">"debug"</font>))
00175         showDebugMessages = <font class="keyword">true</font>;
00176 
00177     <font class="keywordflow">if</font> (kapp-&gt;isRestored()){
00178         <font class="keywordflow">for</font>(<font class="keywordtype">int</font> n = 1; KMainWindow::canBeRestored(n); n++)
00179             (<font class="keyword">new</font> <a class="code" href="class_bible_time.html">BibleTime</a>)-&gt;restore(n);
00180     }
00181     <font class="keywordflow">else</font> {
00182         <font class="keyword">const</font> <font class="keywordtype">bool</font> showIt = CBTConfig::get(CBTConfig::logo);    
00183 
00184         <font class="keywordflow">if</font>(showIt) {
00185             KStartupLogo::createSplash();
00186             KStartupLogo::showSplash();             
00187             KStartupLogo::setStatusMessage( i18n(<font class="stringliteral">"Starting BibleTime"</font>) + QString::fromLatin1(<font class="stringliteral">"..."</font>) );
00188         }
00189         
00190         bibletime = <font class="keyword">new</font> <a class="code" href="class_bible_time.html">BibleTime</a>();
00191         app.setMainWidget(bibletime);
00192 
00193         <font class="keywordflow">if</font> (showIt) {
00194             KStartupLogo::hideSplash();
00195             KStartupLogo::deleteSplash();               
00196         }
00197 
00198         <font class="comment">// a new BibleTime version was installed (maybe a completely new installation)</font>
00199         <font class="keywordflow">if</font> (CBTConfig::get(CBTConfig::bibletimeVersion) != VERSION) {
00200             CBTConfig::set(CBTConfig::bibletimeVersion, VERSION);
00201             <a class="code" href="class_c_h_t_m_l_dialog.html">CHTMLDialog</a> dlg(HELPDIALOG_FIRST_START);
00202             dlg.exec();
00203             bibletime-&gt;<a class="code" href="class_bible_time.html#g1">slotSettingsOptions</a>();
00204         }           
00205 
00206         <font class="comment">//The tip of the day</font>
00207         <font class="keywordflow">if</font> (CBTConfig::get(CBTConfig::tips))
00208             bibletime-&gt;<a class="code" href="class_bible_time.html#g0">slotHelpTipOfDay</a>();
00209 
00210         bibletime-&gt;<a class="code" href="class_bible_time.html#a2">show</a>();
00211         
00212         <font class="comment">// restore the workspace</font>
00213 <font class="comment">//      if (CBTConfig::get(CBTConfig::restoreWorkspace) &amp;&amp; !args-&gt;isSet("ignore-startprofile"))</font>
00214 <font class="comment">//          bibletime-&gt;restoreWorkspace();</font>
00215     bibletime-&gt;<a class="code" href="class_bible_time.html#g8">processCommandline</a>();
00216 
00217         setSignalHandler(signalHandler);        
00218         
00219         <font class="keyword">const</font> <font class="keywordtype">int</font> ret = app.exec();
00220         <font class="keyword">delete</font> bibletime;
00221         CPointers::deleteBackend();
00222         <font class="keywordflow">return</font> ret;
00223     }
00224 }
00225 
</pre></div><hr><address align="right"><small>Generated on Tue Jul 16 13:53:10 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
