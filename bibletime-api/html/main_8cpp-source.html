<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>main.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>main.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment">                          main.cpp  -  The file containing main ;-)</font>
00003 <font class="comment">                             -------------------</font>
00004 <font class="comment">    begin                : Mit Jan 19 12:57:15 CET 2000</font>
00005 <font class="comment">    copyright            : (C) 2000 by The BibleTime Team</font>
00006 <font class="comment">    email                : Info@bibletime.de</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment">*                                                                         *</font>
00011 <font class="comment">*   This program is free software; you can redistribute it and/or modify  *</font>
00012 <font class="comment">*   it under the terms of the GNU General Public License as published by  *</font>
00013 <font class="comment">*   the Free Software Foundation; either version 2 of the License, or     *</font>
00014 <font class="comment">*   (at your option) any later version.                                   *</font>
00015 <font class="comment">*                                                                         *</font>
00016 <font class="comment">***************************************************************************/</font>
00017 
00018     
00019 <font class="comment">/* $Header$ */</font>
00020 <font class="comment">/* $Revision$ */</font>
00021 
00022 <font class="comment">//standard includes</font>
00023 <font class="preprocessor">#include &lt;stdlib.h&gt;</font>
00024 <font class="preprocessor">#include &lt;stdio.h&gt;</font>
00025 <font class="preprocessor">#include &lt;signal.h&gt;</font>
00026 
00027 <font class="comment">//own includes</font>
00028 <font class="preprocessor">#include "resource.h"</font>
00029 <font class="preprocessor">#include "bibletime.h"</font>
00030 <font class="preprocessor">#include "config.h"</font>
00031 
00032 <font class="comment">//frontend includes</font>
00033 <font class="preprocessor">#include "frontend/kstartuplogo.h"</font>
00034 <font class="preprocessor">#include "frontend/chtmldialog.h"</font>
00035 <font class="preprocessor">#include "frontend/cbtconfig.h"</font>
00036 
00037 <font class="comment">//KDE includes</font>
00038 <font class="preprocessor">#include &lt;kcmdlineargs.h&gt;</font>
00039 <font class="preprocessor">#include &lt;kcrash.h&gt;</font>
00040 <font class="preprocessor">#include &lt;kglobal.h&gt;</font>
00041 <font class="preprocessor">#include &lt;kapp.h&gt;</font>
00042 <font class="preprocessor">#include &lt;kstddirs.h&gt;</font>
00043 <font class="preprocessor">#include &lt;kinstance.h&gt;</font>
00044 <font class="preprocessor">#include &lt;kaboutdata.h&gt;</font>
00045 <font class="preprocessor">#include &lt;klocale.h&gt;</font>
00046 <font class="preprocessor">#include &lt;kiconloader.h&gt;</font>
00047 
00048 <font class="comment">//Removed duplicate includes</font>
00049 
00050 <font class="comment">//Qt includes</font>
00051 <font class="preprocessor">#include &lt;qfont.h&gt;</font>
00052 
00053 <font class="keywordtype">bool</font> showDebugMessages = <font class="keyword">false</font>;
00054 <a class="code" href="class_bible_time.html">BibleTime</a>* bibletime = 0;
00055 
00056 <font class="keywordtype">void</font> myMessageOutput( QtMsgType type, <font class="keyword">const</font> <font class="keywordtype">char</font> *msg ) {   
00057     <font class="comment">//we use this messagehandler to switch debugging off in final releases</font>
00058     <font class="keywordflow">switch</font> ( type ) {
00059         <font class="keywordflow">case</font> QtDebugMsg:
00060             <font class="keywordflow">if</font> (showDebugMessages)  <font class="comment">//only show messages if they are enabled!</font>
00061                 fprintf( stderr,<font class="stringliteral">"(BibleTime %s) Debug: %s\n"</font>,VERSION, msg );
00062             <font class="keywordflow">break</font>;
00063         <font class="keywordflow">case</font> QtWarningMsg:
00064                 fprintf( stderr,<font class="stringliteral">"(BibleTime %s) WARNING: %s\n"</font>,VERSION, msg );
00065             <font class="keywordflow">break</font>;
00066         <font class="keywordflow">case</font> QtFatalMsg:
00067             fprintf( stderr,<font class="stringliteral">"(BibleTime %s) _FATAL_: %s\nPlease contact info@bibletime.de and report this bug!"</font>,VERSION, msg );
00068             abort();    <font class="comment">// dump core on purpose</font>
00069     }
00070 }
00071 
00072 <font class="keyword">extern</font> <font class="stringliteral">"C"</font> {
00073     <font class="keyword">static</font> <font class="keywordtype">void</font> setSignalHandler(<font class="keywordtype">void</font> (*handler)(<font class="keywordtype">int</font>));
00074 
00075     <font class="comment">// Crash recovery signal handler</font>
00076     <font class="keyword">static</font> <font class="keywordtype">void</font> signalHandler(<font class="keywordtype">int</font> sigId) {
00077         setSignalHandler(SIG_DFL);
00078         fprintf(stderr, <font class="stringliteral">"*** BibleTime got signal %d (Exiting)\n"</font>, sigId);
00079         <font class="comment">// try to cleanup all windows</font>
00080         <font class="keywordflow">if</font> (bibletime) {
00081             bibletime-&gt;<a class="code" href="class_bible_time.html#a4">saveSettings</a>();
00082             fprintf(stderr, <font class="stringliteral">"Saving seems to be succesful\n"</font>);      
00083         }
00084         ::exit(-1); <font class="comment">//</font>
00085     }
00086 
00087     <font class="comment">// Crash recovery signal handler</font>
00088     <font class="keyword">static</font> <font class="keywordtype">void</font> crashHandler(<font class="keywordtype">int</font> sigId) {
00089         setSignalHandler(SIG_DFL);
00090         fprintf(stderr, <font class="stringliteral">"*** BibleTime got signal %d (Crashing). Trying to save settings.\n"</font>, sigId);
00091         <font class="keywordflow">if</font> (bibletime) {
00092             bibletime-&gt;<a class="code" href="class_bible_time.html#a4">saveSettings</a>();
00093             fprintf(stderr, <font class="stringliteral">"Saving seemed to be succesful\n"</font>);     
00094         }
00095         <font class="comment">// Return to DrKonqi.</font>
00096     }
00097 
00098     <font class="keyword">static</font> <font class="keywordtype">void</font> setSignalHandler(<font class="keywordtype">void</font> (*handler)(<font class="keywordtype">int</font>)) {
00099         signal(SIGKILL, handler);
00100         signal(SIGTERM, handler);
00101         signal(SIGHUP,  handler);
00102         KCrash::setEmergencySaveFunction(crashHandler);
00103     }
00104 }
00105 
00106 <font class="keywordtype">int</font> main(<font class="keywordtype">int</font> argc, <font class="keywordtype">char</font>* argv[]) {
00107     qInstallMsgHandler( myMessageOutput );
00108 
00109     <font class="comment">//create about data for this application</font>
00110     <font class="keyword">static</font> KCmdLineOptions options[] =
00111     {
00112         {<font class="stringliteral">"debug"</font>, I18N_NOOP(<font class="stringliteral">"Enable debug messages"</font>),0},
00113         {0,0,0}
00114     };  
00115         
00116     KAboutData aboutData(
00117         PACKAGE,
00118         <font class="stringliteral">"BibleTime"</font>,
00119         VERSION,
00120         I18N_NOOP(<font class="stringliteral">"Bible study tool for KDE 2"</font>),
00121         KAboutData::License_GPL_V2,
00122         I18N_NOOP(<font class="stringliteral">"(c)1999-2002, The BibleTime Team"</font>),
00123         I18N_NOOP(<font class="stringliteral">"BibleTime is an easy to use but powerful Bible study tool for KDE 2.\n\nWe are looking for translators and handbook authors.\nIf you'd like to join use send an eMail to info@bibletime.de."</font>),
00124         <font class="stringliteral">"http://www.bibletime.de/"</font>,
00125         <font class="stringliteral">"info@bibletime.de"</font>
00126     );
00127     
00128     <font class="comment">//we could so change this to a file reading function (including commented out people</font>
00129     <font class="comment">//coders</font>
00130     aboutData.addAuthor(<font class="stringliteral">"Joachim Ansorg"</font>, I18N_NOOP(<font class="stringliteral">"Project coordinator, frontend, backend"</font>), <font class="stringliteral">"jansorg@gmx.de"</font>,<font class="stringliteral">""</font>);
00131     aboutData.addAuthor(<font class="stringliteral">"Martin Gruner"</font>,    I18N_NOOP(<font class="stringliteral">"Frontend, backend"</font>), <font class="stringliteral">"mg.pub@gmx.net"</font>, <font class="stringliteral">""</font>);
00132     aboutData.addAuthor(<font class="stringliteral">"Mark Lybarger"</font>,    I18N_NOOP(<font class="stringliteral">"Searchdialog"</font>), <font class="stringliteral">"mlybarge@insight.rr.com"</font>, <font class="stringliteral">""</font>);
00133 <font class="comment">//  aboutData.addAuthor("Chris Kujawa",     I18N_NOOP("Frontend"),"christopher.kujawa@verizon.net", "");</font>
00134 <font class="comment">//  aboutData.addAuthor("Luke Mauldin",     I18N_NOOP("Frontend"),"lukeskyfly@txk.net", "");</font>
00135 <font class="comment">//  aboutData.addAuthor("Tim Brodie",   I18N_NOOP("Installation manager"),"tbrodie@displayworksinc.com", "");</font>
00136 
00137     <font class="comment">//documentation</font>
00138     aboutData.addAuthor(<font class="stringliteral">"Fred Saalbach"</font>,    I18N_NOOP(<font class="stringliteral">"Handbook"</font>), <font class="stringliteral">"saalbach@sybercom.net"</font>, <font class="stringliteral">""</font>);        
00139     
00140     <font class="comment">//translators</font>
00141     aboutData.addAuthor(<font class="stringliteral">"Silvio Bacchetta"</font>,     I18N_NOOP(<font class="stringliteral">"Translation into Italian"</font>), <font class="stringliteral">"sorgilazzaro@tiscalinet.it"</font>, <font class="stringliteral">""</font>);                           
00142     aboutData.addAuthor(<font class="stringliteral">"Nuno Bareto"</font>,              I18N_NOOP(<font class="stringliteral">"Translation into Portoguese"</font>), <font class="stringliteral">"nbarr@clix.pt"</font>, <font class="stringliteral">""</font>); 
00143     aboutData.addAuthor(<font class="stringliteral">"Mario Bertrand"</font>,     I18N_NOOP(<font class="stringliteral">"Translation into French"</font>), <font class="stringliteral">"mbert@tbrq.org"</font>, <font class="stringliteral">""</font>);          
00144     aboutData.addAuthor(<font class="stringliteral">"Benedykt P. Barszcz"</font>,I18N_NOOP(<font class="stringliteral">"Translation into Polish"</font>), <font class="stringliteral">"kb2qzv@box43.gnet.pl"</font>, <font class="stringliteral">""</font>);        
00145     aboutData.addAuthor(<font class="stringliteral">"Birger Langkjer"</font>,      I18N_NOOP(<font class="stringliteral">"Translation into Danish"</font>), <font class="stringliteral">"birger.langkjer@image.dk"</font>, <font class="stringliteral">""</font>);              
00146     aboutData.addAuthor(<font class="stringliteral">"Zdeno Podobny"</font>,            I18N_NOOP(<font class="stringliteral">"Translation into Slovak"</font>), <font class="stringliteral">"zdpo@post.sk"</font>, <font class="stringliteral">""</font>);  
00147     aboutData.addAuthor(<font class="stringliteral">"Michal Rovnaník"</font>,      I18N_NOOP(<font class="stringliteral">"Translation into Czech"</font>), <font class="stringliteral">"Michal.Rovnanik@seznam.cz"</font>, <font class="stringliteral">""</font>);          
00148     aboutData.addAuthor(<font class="stringliteral">"Eduardo Sanchez"</font>,      I18N_NOOP(<font class="stringliteral">"Translation into Spanish"</font>), <font class="stringliteral">"csanche2@calvin.edu"</font>, <font class="stringliteral">""</font>);          
00149     aboutData.addAuthor(<font class="stringliteral">"Beda Szukics"</font>,             I18N_NOOP(<font class="stringliteral">"Translation into Italian"</font>), <font class="stringliteral">"bszukics@bluewin.ch"</font>, <font class="stringliteral">""</font>);                              
00150     aboutData.addAuthor(<font class="stringliteral">"Balint Sandor"</font>,            I18N_NOOP(<font class="stringliteral">"Translation into Hungarian"</font>), <font class="stringliteral">"balintsa@freemail.hu"</font>, <font class="stringliteral">""</font>);               
00151     aboutData.addAuthor(<font class="stringliteral">"Espen Trydal"</font>,             I18N_NOOP(<font class="stringliteral">"Translation into Norwegian"</font>), <font class="stringliteral">"etrydal@postkassa.no"</font>, <font class="stringliteral">""</font>);       
00152 <font class="comment">//  aboutData.addAuthor("Jonathan Jones",           I18N_NOOP("Translation into Brazilian Portoguese"), "jones@brfree.com.br", "");                 </font>
00153 <font class="comment">//  aboutData.addAuthor("Walter Rodrigo de Sá Cruz",            I18N_NOOP("Translation into Portoguese"), "keytech@ig.com.br", "");     </font>
00154     aboutData.addAuthor(<font class="stringliteral">"Kees van Veen"</font>,            I18N_NOOP(<font class="stringliteral">"Translation into Dutch"</font>), <font class="stringliteral">"cvn@interchain.nl"</font>, <font class="stringliteral">""</font>);  
00155                                                         
00156     <font class="comment">//credits</font>
00157     aboutData.addCredit(<font class="stringliteral">"Bob Harman"</font>,   I18N_NOOP(<font class="stringliteral">"Bible study HowTo"</font>), <font class="stringliteral">"N_Cov_Church@compuserve.com"</font>, <font class="stringliteral">""</font>);     
00158 <font class="comment">//  aboutData.addCredit("Darwin Gregory", I18N_NOOP("Optionsdialog"), "darwin@ichristian.com", "");     </font>
00159 <font class="comment">//  aboutData.addCredit("Jeffrey Hoyt",     I18N_NOOP("handbook"), "jeffhoyt@earthlink.net", "http://jhoyt.faithweb.com");  </font>
00160 <font class="comment">//  aboutData.addCredit("Juho Vahakangas", I18N_NOOP("Martin Luther startup logo"), "juhov@freenet.fi", "");</font>
00161 <font class="comment">//  aboutData.addCredit("Thomas Hagedorn", I18N_NOOP("Sponsor of www.bibletime.de"), "tom@delix.de", "");       </font>
00162 <font class="comment">//  aboutData.addCredit("Torsten Uhlmann", I18N_NOOP("backend"), "TUhlmann@gmx.de", "http://tuhlmann.purespace.de");</font>
00163 <font class="comment">//  aboutData.addCredit("Troy A. Griffits", I18N_NOOP("Leader of the SWORD project.\nLots of help with the SWORD API!"), "scribe@crosswire.org", "");   </font>
00164         
00165     KCmdLineArgs::init(argc, argv, &amp;aboutData);     
00166     KCmdLineArgs::addCmdLineOptions ( options );
00167     
00168 
00169     KApplication app;
00170     KGlobal::dirs()-&gt;addResourceType(<font class="stringliteral">"BT_pic"</font>, <font class="stringliteral">"share/apps/bibletime/pics/"</font>);
00171 
00172     KCmdLineArgs *args = KCmdLineArgs::parsedArgs();
00173 
00174     <font class="comment">// A binary option (on / off)</font>
00175     <font class="keywordflow">if</font> (args-&gt;isSet(<font class="stringliteral">"debug"</font>))
00176         showDebugMessages = <font class="keyword">true</font>;
00177 
00178     <font class="keywordflow">if</font> (kapp-&gt;isRestored()){
00179         <font class="keywordflow">for</font>(<font class="keywordtype">int</font> n = 1; KMainWindow::canBeRestored(n); n++)
00180             (<font class="keyword">new</font> <a class="code" href="class_bible_time.html">BibleTime</a>)-&gt;restore(n);
00181     }
00182     <font class="keywordflow">else</font> {
00183         <font class="keyword">const</font> <font class="keywordtype">bool</font> showIt = CBTConfig::get(CBTConfig::logo);    
00184 
00185         <font class="keywordflow">if</font>(showIt) {
00186             KStartupLogo::createSplash();
00187             KStartupLogo::showSplash();             
00188             KStartupLogo::setStatusMessage( i18n(<font class="stringliteral">"Starting BibleTime"</font>) + QString::fromLatin1(<font class="stringliteral">"..."</font>) );
00189         }
00190         
00191         bibletime = <font class="keyword">new</font> <a class="code" href="class_bible_time.html">BibleTime</a>();
00192 
00193         <font class="keywordflow">if</font> (showIt) {
00194             KStartupLogo::hideSplash();
00195             KStartupLogo::deleteSplash();               
00196         }
00197 
00198         <font class="comment">// a new BibleTime version was installed (maybe a completely new installation)</font>
00199         <font class="keywordflow">if</font> (CBTConfig::get(CBTConfig::bibletimeVersion) != VERSION) {
00200             CBTConfig::set(CBTConfig::bibletimeVersion, VERSION);
00201             HTML_DIALOG(HELPDIALOG_FIRST_START);
00202             bibletime-&gt;<a class="code" href="class_bible_time.html#g1">slotSettingsOptions</a>();
00203         }           
00204 
00205         <font class="comment">//The tip of the day</font>
00206         <font class="keywordflow">if</font> (CBTConfig::get(CBTConfig::tips))
00207             bibletime-&gt;<a class="code" href="class_bible_time.html#g0">slotHelpTipOfDay</a>();
00208 
00209         bibletime-&gt;<a class="code" href="class_bible_time.html#a2">show</a>();          
00210         
00211         <font class="comment">// restore the workspace</font>
00212         <font class="keywordflow">if</font> (CBTConfig::get(CBTConfig::restoreWorkspace))
00213             bibletime-&gt;<a class="code" href="class_bible_time.html#a5">restoreWorkspace</a>();
00214 
00215         setSignalHandler(signalHandler);        
00216         
00217         <font class="keyword">const</font> <font class="keywordtype">int</font> ret = app.exec();
00218         CPointers::deleteBackend();
00219 
00220         <font class="keywordflow">return</font> ret;
00221     }
00222 }
00223 
</pre></div><hr><address><small>Generated on Sun Mar 10 22:12:47 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
